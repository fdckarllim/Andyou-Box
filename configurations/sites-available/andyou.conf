# setup localhost
<VirtualHost *:443>
    ServerName inn-localhost.nativecamp.net
    DocumentRoot "/var/www/html"
    SSLEngine on
    SSLCertificateFile /vagrant/ssl/stg-node.nativecamp.net.crt
    SSLCertificateKeyFile /vagrant/ssl/stg-node.nativecamp.net.nopass.key
    SSLCertificateChainFile /vagrant/ssl/stg-node.nativecamp.net.ca.crt

    SetEnv INN_ENV local
    <Directory "/var/www/html">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

# setup admin webserver
<VirtualHost *:443>
    ServerName inn-admin.nativecamp.net
    DocumentRoot "/var/www/inn_admin/webroot"
    SSLEngine on
    SSLCertificateFile /vagrant/ssl/stg-node.nativecamp.net.crt
    SSLCertificateKeyFile /vagrant/ssl/stg-node.nativecamp.net.nopass.key
    SSLCertificateChainFile /vagrant/ssl/stg-node.nativecamp.net.ca.crt

    SetEnv INN_ENV local
    <Directory "/var/www/inn_admin/webroot">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Require all granted
    </Directory>

    RewriteEngine On
    RewriteCond %{REQUEST_URI}  ^/socket.io            [NC]
    RewriteCond %{QUERY_STRING} transport=websocket    [NC]
    RewriteRule /(.*)           ws://inn-localhost.nativecamp.net:3000/$1 [P,L]

    SSLProxyEngine on
    ProxyRequests Off
    ProxyPass        /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPassReverse /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPass        /realtime_api https://inn-localhost.nativecamp.net:3000
    ProxyPassReverse /realtime_api https://inn-localhost.nativecamp.net:3000
</VirtualHost>

# setup front webserver
<VirtualHost *:443>
    ServerName inn-variety.nativecamp.net
    DocumentRoot "/var/www/inn_macherie_front/webroot"
    SSLEngine on
    SSLCertificateFile /vagrant/ssl/stg-node.nativecamp.net.crt
    SSLCertificateKeyFile /vagrant/ssl/stg-node.nativecamp.net.nopass.key
    SSLCertificateChainFile /vagrant/ssl/stg-node.nativecamp.net.ca.crt

    SetEnv INN_ENV local
    <Directory "/var/www/inn_macherie_front/webroot">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Require all granted
    </Directory>

    RewriteEngine On
    RewriteCond %{REQUEST_URI}  ^/socket.io            [NC]
    RewriteCond %{QUERY_STRING} transport=websocket    [NC]
    RewriteRule /(.*)           ws://inn-localhost.nativecamp.net:3000/$1 [P,L]

    SSLProxyEngine on
    ProxyRequests Off
    ProxyPass        /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPassReverse /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPass        /realtime_api https://inn-localhost.nativecamp.net:3000
    ProxyPassReverse /realtime_api https://inn-localhost.nativecamp.net:3000
    
    ProxyPass        /dm_api https://inn-localhost.nativecamp.net/inn_prototype_dm
    ProxyPassReverse /dm_api https://inn-localhost.nativecamp.net/inn_prototype_dm
</VirtualHost>

# setup dm webserver
<VirtualHost *:443>
    ServerName inn-dm.nativecamp.net
    DocumentRoot "/var/www/inn_prototype_dm"
    SSLEngine on
    SSLCertificateFile /vagrant/ssl/stg-node.nativecamp.net.crt
    SSLCertificateKeyFile /vagrant/ssl/stg-node.nativecamp.net.nopass.key
    SSLCertificateChainFile /vagrant/ssl/stg-node.nativecamp.net.ca.crt

    SetEnv INN_ENV local
    <Directory "/var/www/inn_prototype_dm">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Require all granted
    </Directory>

    RewriteEngine On
    RewriteCond %{REQUEST_URI}  ^/socket.io            [NC]
    RewriteCond %{QUERY_STRING} transport=websocket    [NC]
    RewriteRule /(.*)           ws://inn-localhost.nativecamp.net:3000/$1 [P,L]

    SSLProxyEngine on
    ProxyRequests Off
    ProxyPass        /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPassReverse /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPass        /realtime_api https://inn-localhost.nativecamp.net:3000
    ProxyPassReverse /realtime_api https://inn-localhost.nativecamp.net:3000
</VirtualHost>

# setup dm webserver
<VirtualHost *:443>
    ServerName inn-mm.nativecamp.net
    DocumentRoot "/var/www/inn_prototype_mm"
    SSLEngine on
    SSLCertificateFile /vagrant/ssl/stg-node.nativecamp.net.crt
    SSLCertificateKeyFile /vagrant/ssl/stg-node.nativecamp.net.nopass.key
    SSLCertificateChainFile /vagrant/ssl/stg-node.nativecamp.net.ca.crt

    SetEnv INN_ENV local
    <Directory "/var/www/inn_prototype_mm">
        Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Require all granted
    </Directory>

    RewriteEngine On
    RewriteCond %{REQUEST_URI}  ^/socket.io            [NC]
    RewriteCond %{QUERY_STRING} transport=websocket    [NC]
    RewriteRule /(.*)           ws://inn-localhost.nativecamp.net:3000/$1 [P,L]

    SSLProxyEngine on
    ProxyRequests Off
    ProxyPass        /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPassReverse /socket.io https://inn-localhost.nativecamp.net:3000/socket.io
    ProxyPass        /realtime_api https://inn-localhost.nativecamp.net:3000
    ProxyPassReverse /realtime_api https://inn-localhost.nativecamp.net:3000
</VirtualHost>